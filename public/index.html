<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>MTGA Draft</title>
	<meta name="description" content="Draft with your friends using your Magic Arena card collection.">
	<meta name="keywords" content="Magic, Arena, Magic the Gathering, MTG, Magic Arena, MTGA, Booster, Limited, Sealed, Draft, Friend, Direct Challenge">
	<meta property="og:title" content="MTGA Draft">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://mtgadraft.herokuapp.com/">
	<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/en/a/aa/Magic_the_gathering-card_back.jpg">
	<meta property="og:description" content="Draft with your friends using your Magic Arena card collection.">
	<meta property="og:site_name" content="MTGA Draft">
	
	<link rel="stylesheet" href="css/style.css" />
	<link rel="stylesheet" href="css/modal.css" />
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

	<script type="text/x-template" id="modal-template">
	  <transition name="modal">
		<div class="modal-mask">
		  <div class="modal-wrapper">
			<div class="modal-container">

			  <div class="modal-header">
				<slot name="header">
				  ???
				</slot>
			  </div>

			  <div class="modal-body">
				<slot name="body">
				  Loading...
				</slot>
			  </div>

			  <div class="modal-footer">
				<slot name="footer">
					<button class="modal-default-button" @click="$emit('close')">
						Close
					</button>
				</slot>
			  </div>
			</div>
		  </div>
		</div>
	  </transition>
	</script>
</head>
<body>
	<div id="main-vue">
		<div v-show="cards == undefined">
			<div class="loading"></div>
			<span>Loading cards data...</span>
		</div>
		
		<div id="view-controls" class="main-controls">
			<span>
				<label for="user-name">User Name</label><input type="text" id="user-name" name="user-name" v-model="userName" />
				<span class="v-separator"></span>
				<label for="language">Language</label>
				<select v-model="language" name="language">
					<option v-for="lang in languages" v-bind:value="lang.code">{{ lang.name }}</option>
				</select>
				<span class="v-separator"></span>
				<label for="card-order">Card Order</label>
				<select v-model="cardOrder" name="card-order">
					<option value="">Booster</option>
					<option value="CMC">CMC</option>
					<option value="Color">Color</option>
					<option value="Rarity">Rarity</option>
				</select>
				<span class="v-separator"></span>
				<label for="file-input">MTGA Collection</label><input type="file" id="file-input" @change="parseMTGALog" style="display:none" accept=".txt" /><button onclick="document.querySelector('#file-input').click()" title="Import your collection by uploading your output_log.txt">Upload <i v-if="hasCollection" class="fas fa-check green" title="Collection uploaded."></i></button>
				<button v-if="hasCollection" title="Stats." @click="showModal = true">Stats</button>
				
				<span v-show="Object.keys(collection).length > 0">
					<span class="v-separator"></span>
					<input type="checkbox" v-model="useCollection" id="useCollection" title="Uncheck this to draft using every cards." /><label for="useCollection">Restrict to Collection</label>
				</span>
			</span>
			
			<span v-bind:class="{ disabled: drafting || publicSessions.length == 0 }" id="session-controls">
				<label for="public-sessions">Public sessions</label>
				<select id="public-sessions" v-model:value="selectedPublicSession">
					<option v-for="s in publicSessions" v-bind:value="s">
					{{ s }}
					</option>
				</select>
				<input type="button" value="Join" @click="joinPublicSession"/>
			</span>
		</div>
		<div class="generic-container">
			<div id="limited-controls" class="main-controls" v-bind:class="{ disabled: drafting }">
				<span id="draft-controls">
					<label for="session-id" title="Share it with your friends!">Session ID</label><input type="text" id="session-id" v-model="sessionID" />
					<span class="v-separator"></span>
					<input type="checkbox" v-model="isPublic" id="is-public" title="Share your session ID with everyone." /><label for="is-public" title="Share your session ID with everyone.">Public</label>
					<span class="v-separator"></span>
					<label for="set-restriction">Restrict Set</label>
					<select id="set-restriction" v-model:value="setRestriction">
						<option value=""></option>
						<option v-for="set in sets" v-bind:value="set">
						{{ set }}
						</option>
					</select>
					<span class="v-separator"></span>
					<label for="boosters-per-player">Boosters per Player</label><input type="number" id="boosters-per-player" class="booster-count" min="1" max="25" step="1" v-model="boostersPerPlayer" />
					<span class="v-separator"></span>
					<label for="bots">Bots</label><input type="number" id="bots" class="booster-count" min="0" max="7" step="1" v-model="bots" />
					<span class="v-separator"></span>
					<div class="check-button-container">
						<input type="checkbox" v-model="readyToDraft" id="readyToDraft" class="check-button" /><label for="readyToDraft">Ready to Draft</label>
					</div>
				</span>
				
				<span id="sealed-controls">
					<strong>Sealed</strong>: Boosters per Player: <input type="number" class="booster-count" v-model="sealedBoosterPerPlayer" min="1" max="25" step="1" /><input type="button" value="Distribute" @click="distributeSealed"/>
				</span>
			</div>
			<div v-show="drafting" id="draft-in-progress">
				Draft in progress!
			</div>
		</div>
		<div class="main-controls session-players">
			Session Players:
			<ul class="player-list">
				<li v-for="user in sessionUsers" :title="user.userID">
					{{ user.userName }}
					<div class="status-icons">
						<template v-if="Object.entries(user.collection).length === 0 && user.collection.constructor === Object">
							<i class="fas fa-book red" :title="user.userName + ' has not uploaded their collection yet.'"></i>
						</template>
						<template v-else>
							<i class="fas fa-book green" :title="user.userName + ' has uploaded their collection.'"></i>
						</template>
						<template v-if="drafting">
							<template v-if="user.pickedCard">
								<i class="fas fa-check green" :title="user.userName + ' has picked a card.'"></i>
							</template>
							<template v-else>
								<i class="fas fa-spinner fa-spin" :title="user.userName + ' is thinking...'"></i>
							</template>
						</template>
						<template v-else>
							<i v-if="user.readyToDraft" class="fas fa-check green" :title="user.userName + ' is ready to draft!'"></i>
						</template>
					</div>
				</li>
			</ul>
			<small v-if="!drafting">(Draft will begin when the session has at least 2 players and everybody is ready.)</small>
			<small v-if="drafting && bots > 0">(...and {{bots}} bot(s) picking cards at random!)</small>
			<div class="chat">
				<button>Chat History</button>
				<form @submit.prevent="sendChatMessage">
					<input type="text" placeholder="Chat with players in your session." />
				</form>
			</div>
		</div>
		<template v-if="drafting">
			<div v-show="draftingState == 'picking'" id="booster-container" class="container">
				<div id="booster-controls" class="controls">
					<h2>Your Booster</h2><span>Booster #{{ Math.floor(cardSelection.length/14) + 1 }}, Pick {{ (cardSelection.length % 14) +1 }}</span>
					<input type="button" @click="pickCard" value="Confirm Pick" v-if="selectedCardId != undefined"/>
				</div>
				<div class="booster card-container">
					<figure is="card" v-for="(card, index) in booster" v-bind:key="index" v-bind:card="card" v-bind:language="language" v-bind:selectcard="selectCard" v-bind:selected="selectedCardId == card.id"></figure>
				</div>
			</div>
			<div v-show="draftingState == 'waiting'" class="pick-waiting">
				<span class="spinner"></span>Waiting for other players to pick...
			</div>
		</template>
		<div v-show="draftingState == 'brewing'" class="container">
			<div id="brewing-controls" class="controls">
				<h2>Deck ({{deck.length}})</h2>
				<template v-if="deck.length > 0">
					<button type="button" @click="exportDeck">Export Deck to MTGA</button>
				</template>
			</div>
			<div class="deck card-container">
				<template v-if="deck.length == 0">
					<div><h3>Your deck is currently empty!</h3><p>Click on your cards to add them to your deck. Don't forget to add lands in MTGA! :)</p></div>
				</template>
				<div v-for="cmc_column in deckCMC" class="cmc-column">
					<figure is="card" v-for="(card, index) in cmc_column" v-bind:key="index" v-bind:card="card" v-bind:language="language" v-bind:selectcard="removeFromDeck"></figure>
				</div>
			</div>
		</div>
		<div v-if="cardSelection != undefined && cardSelection.length > 0" id="card-pool-container" class="container">
			<div id="card-pool-controls" class="controls">
				<h2>Your cards</h2>
				<button type="button" @click="exportSelection">Export to MTGA</button>
			</div>
			<div class="card-pool card-container">
				<template v-if="cardOrder == 'CMC'">
					<figure is="card" v-for="(card, index) in selectionCMC" v-bind:key="index" v-bind:card="card" v-bind:language="language" v-bind:selectcard="addToDeck"></figure>
				</template>
				<template v-else-if="cardOrder == 'Color'">
					<figure is="card" v-for="(card, index) in selectionColor" v-bind:key="index" v-bind:card="card" v-bind:language="language" v-bind:selectcard="addToDeck"></figure>
				</template>
				<template v-else-if="cardOrder == 'Rarity'">
					<figure is="card" v-for="(card, index) in selectionRarity" v-bind:key="index" v-bind:card="card" v-bind:language="language" v-bind:selectcard="addToDeck"></figure>
				</template>
				<template v-else>
					<figure is="card" v-for="(card, index) in cardSelection" v-bind:key="index" v-bind:card="card" v-bind:language="language" v-bind:selectcard="addToDeck"></figure>
				</template>
			</div>
		</div>
		<div class="welcome" v-if="!drafting && (cardSelection == undefined || cardSelection.length == 0)">
			<p>Welcome to MTGADraft!</p>
			<p>Want to draft in MTGA with your friends? Noticed you currently can't do that natively? We're here for you!</p>
			<ol>
				<li>Use the controls on the top of the page to enter your User Name and indicate your preferences.</li>
				<li><a onclick="document.querySelector('#file-input').click()">Upload your MTGA logs</a> (you should find them at <tt>C:\Users\YourName\AppData\LocalLow\Wizards Of The Coast\MTGA\output_log.txt</tt>) to restrict the draft to the cards you actually own in the game. <strong>Important Note</strong>: Detailed logs now have to be enabled in game, the toggle can be found in Options > View Account > Detailed Logs (Plugin Support), importing your collection won't work without this activated.</li>
				<li>Share your session ID with your friends (or join their own session) and click ready to start drafting!</li>
			</ol>
			<p>Options:
				<ul>
					<li>Session ID: A unique identifier for your session, you can use any name, just make sure to use the same as your friends to play with them!</li>
					<li>Public: Flags your session as public. It will appear in the "Public Sessions" menu so anyone can directly join.</li>
					<li>Boosters per Player: MTGA doesn't currently allow to play in Direct Challenge with deck containing less than 60 cards, so you may want to adjust this. Shared by everyone in your session.</li>
					<li>Bots (WIP!) : Adds virtual players to your draft. Right now they are <strong>very dumb</strong>, so their utility is limited, I may try to improve them in the futur.</li>
					<li>Restrict Set: Select a set to draft using only with cards from this set. Shared by everyone in your session.</li>
					<li>Restrict to Collection: If unchecked, your collection will not limit the cards available. If every players unchecks this, you will draft using every cards. (Particularly useful if you don't intend on playing specifically on MTGA)</li>
				</ul>
			</p>
		</div>
		<modal v-if="showModal" @close="showModal = false">
			<h3 slot="header">Collection Statistics</h3>
			<h3 slot="body" v-if="collectionStats !== undefined">
				<select v-model="statsSelectedSet">
					<option v-for="set in sets" v-bind:value="set">{{ collectionStats[set].fullName }}</option>
				</select>
				<div v-for="set in sets" v-show="statsSelectedSet === set">
					<table>
						<caption>{{collectionStats[set].fullName}}</caption>
						<tr><th>Rarity</th><th>Unique</th><th>Total</th><th>Missing Total</th></tr>
						<tr><td>Total</td><td>{{collectionStats[set].cards.length}}/{{collectionStats[set].total.unique}}</td><td>{{collectionStats[set].cardCount}}/{{4 * collectionStats[set]['total']['unique']}}</td><td>{{4 * collectionStats[set]['total']['unique'] - collectionStats[set].cardCount}}</td></tr>
						<tr v-for="r in ['common', 'uncommon', 'rare', 'mythic']" v-if="collectionStats[set][r + 'Count'] && collectionStats[set]['total'][r + 'Count'] > 0">
							<td>{{r}}</td><td>{{collectionStats[set][r].length}}/{{collectionStats[set]['total'][r + 'Count']}}</td><td>{{collectionStats[set][r + 'Count']}}/{{4 * collectionStats[set]['total'][r + 'Count']}}</td><td>{{4 * collectionStats[set]['total'][r + 'Count'] - collectionStats[set][r + 'Count']}}</td>
						</tr>
					</table>
				</div>
			</h3>
		</modal>
	</div>
	
	<footer>Made by <a href="http://senryoku.github.io/">Senryoku</a> - <a href="https://www.reddit.com/r/MagicArena/comments/bp5s4h/a_webapp_to_play_draft_with_friends_on_mtga/">Reddit Thread</a> - Get <a href="https://magic.wizards.com/fr/mtgarena">Magic: The Gathering Arena</a></footer>
	
	<!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script> -->
	<script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"></script>
	<script src="./socket.io/socket.io.js"></script>
	<script type="text/javascript" src="js/helper.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
	<script type="text/javascript" src="js/draft.js"></script>
</body>
</html>