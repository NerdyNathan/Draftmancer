<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>MTGA Draft</title>
	<link rel="stylesheet" href="css/style.css" />
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
</head>
<body>
	<div id="main-vue">
		<div v-show="cards == undefined">
			<div class="loading"></div>
			<span>Loading cards data...</span>
		</div>
		
		<div id="view-controls" class="main-controls">
			<label for="user-name">User Name</label><input type="text" id="user-name" name="user-name" v-model="userName" />
			<span class="v-separator"></span>
			<label for="language">Language</label>
			<select v-model="language" name="language">
				<option v-for="lang in languages" v-bind:value="lang.code">{{ lang.name }}</option>
			</select>
			<span class="v-separator"></span>
			<label for="card-order">Card Order</label>
			<select v-model="cardOrder" name="card-order">
				<option value=""></option>
				<option value="CMC">CMC</option>
				<option value="Color">Color</option>
			</select>
			<span class="v-separator"></span>
			<i v-if="hasCollection" class="fas fa-check green" title="Collection uploaded."></i><label for="file-input">Upload MTGA Collection</label><input type="file" id="file-input" @change="parseMTGALog" />
		</div>
		<div class="generic-container">
			<div id="draft-controls" class="main-controls" v-bind:class="{ disabled: drafting }">
				<label for="session-id" title="Share it with your friends!">Session ID</label><input type="text" id="session-id" v-model="sessionID" />
				<span class="v-separator"></span>
				<label for="boosters-per-player">Boosters per Player</label><input type="number" id="boosters-per-player" min="1" max="25" step="1" v-model="boostersPerPlayer" />
				<span class="v-separator"></span>
				<label for="set-restriction">Restrict Set</label>
				<select id="set-restriction" v-model:value="setRestriction">
					<option value=""></option>
					<option v-for="set in sets" v-bind:value="set">
					{{ set }}
					</option>
				</select>
				<span class="v-separator"></span>
				<input type="checkbox" v-model="useCollection" title="Uncheck this to draft using every cards.">Restrict to Collection</input>
				<span class="v-separator"></span>
				<input type="checkbox" v-model="readyToDraft">Ready to Draft</input>
			</div>
			<div v-show="drafting" id="draft-in-progress">
				Draft in progress!
			</div>
		</div>
		<div>
			Session Players:
			<ul class="player-list">
				<li v-for="user in sessionUsers" :title="user.userID">
					{{ user.userName }}
					<template v-if="Object.entries(user.collection).length === 0 && user.collection.constructor === Object">
						<i class="fas fa-book red" :title="user.userName + ' has not uploaded their collection yet.'"></i>
					</template>
					<template v-else>
						<i class="fas fa-book green" :title="user.userName + ' has uploaded their collection.'"></i>
					</template>
					<i v-if="user.readyToDraft" class="fas fa-check green" :title="user.userName + ' is ready to draft!'"></i>
				</li>
			</ul>
			<small>(Draft will begin when the session has at least 2 players and everybody is ready.)</small>
		</div>
		<div id="draft-container" v-if="drafting">
			<div v-show="draftingState == 'picking'" id="booster-container" class="container">
				<div id="booster-controls" class="controls">
					<h2>Your Booster</h2>
					<input type="button" @click="pickCard" value="Confirm Pick" v-if="selectedCardId != undefined"/>
				</div>
				<div class="booster card-container">
					<figure is="card" v-for="(card, index) in booster" v-bind:key="index" v-bind:card="card" v-bind:language="language" v-bind:selectcard="selectCard" v-bind:selected="selectedCardId == card.id"></figure>
				</div>
			</div>
			<div v-show="draftingState == 'waiting'">
				<span class="spinner"></span>Waiting for other players to pick...
				<ul class="player-list">
					<li v-for="user in sessionUsers" :title="user.userID">
						{{ user.userName }}
						<template v-if="user.pickedCard">
							<i class="fas fa-check green" :title="user.userName + ' has picked a card.'"></i>
						</template>
						<template v-else>
							<i class="fas fa-ellipsis-h red" :title="user.userName + ' is thinking...'"></i>
						</template>
					</li>
				</ul>
			</div>
			<div v-show="draftingState == 'brewing'" class="container">
				<div id="brewing-controls" class="controls">
					<h2>Deck</h2>
					<template v-if="deck.length == 0">
						<div>Click on your cards to add them to your deck. Don't forget to add lands in MTGA! :)</div>
					</template>
					<template v-else>
						<button type="button" @click="exportDeck">Export Deck</button>
					</template>
				</div>
				<div class="deck card-container">
					<div v-for="cmc_column in deckCMC" class="cmc-column">
						<figure is="card" v-for="(card, index) in cmc_column" v-bind:key="index" v-bind:card="card" v-bind:language="language" v-bind:selectcard="removeFromDeck"></figure>
					</div>
				</div>
			</div>
			<div v-if="cardSelection != undefined && cardSelection.length > 0" id="card-pool-container" class="container">
				<div id="card-pool-controls" class="controls">
					<h2>Your cards</h2>
				</div>
				<div class="card-pool card-container">
					<template v-if="cardOrder == 'CMC'">
						<figure is="card" v-for="(card, index) in selectionCMC" v-bind:key="index" v-bind:card="card" v-bind:language="language" v-bind:selectcard="addToDeck"></figure>
					</template>
					<template v-else-if="cardOrder == 'Color'">
						<figure is="card" v-for="(card, index) in selectionColor" v-bind:key="index" v-bind:card="card" v-bind:language="language" v-bind:selectcard="addToDeck"></figure>
					</template>
					<template v-else>
						<figure is="card" v-for="(card, index) in cardSelection" v-bind:key="index" v-bind:card="card" v-bind:language="language" v-bind:selectcard="addToDeck"></figure>
					</template>
				</div>
			</div>
		</div>
		<div class="welcome" v-else>
			<p>Welcome to MTGADraft!</p>
			<p>Want to draft in MTGA with your friends for free? Good!</p>
			<p>Use the controls on the top of the page to enter your User Name and indicate your preferences. Upload your MTGA logs (you should find it at <tt>C:/Users/YourName/AppData\LocalLow\Wizards Of The Coast\MTGA\output_log.txt</tt>) to restrict the draft to the cards you actually own in the game. Share your session ID with your friends (or join their own session) and click ready to start drafting!</p>
		</div>
	</div>
	
	<!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script src="./socket.io/socket.io.js"></script>
	<script type="text/javascript" src="js/helper.js"></script>
	<script type="text/javascript" src="js/draft.js"></script>
</body>
</html>